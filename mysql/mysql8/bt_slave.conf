[client]
password = 123456
port = 61786
socket = /tmp/mysql.sock

[mysqldump]
quick
max_allowed_packet = 500M
port = 61786
password = 123456

[mysqld]

# 服务器编号
server-id = 10021395

# 从库特定配置
read_only = 1
super_read_only = 1

# 需要主从复制的数据库
#replicate-do-db = test

# 指定哪个数据库不用同步
binlog-ignore-db = information_schema
binlog-ignore-db = performance_schema
binlog-ignore-db = mysql
binlog-ignore-db = sys
binlog-ignore-db = __recycle_bin__
binlog-ignore-db = __cdb_recycle_bin__
binlog-ignore-db = __tencentdb__

# ---------- 并行复制配置 ----------
# 并行工作线程数
slave_parallel_workers = 32

# 并行复制类型 - 基于逻辑时钟的最优并行模式
slave_parallel_type = LOGICAL_CLOCK

# 从库专用：关闭提交顺序保证以获得最大性能
slave_preserve_commit_order = OFF

# 并行复制缓冲区大小 - 512MB
slave_pending_jobs_size_max = 536870912

# ---------- 从库性能优化 ----------
# 从库不需要binlog
log_bin = OFF
log_slave_updates = OFF

# 从库优化的事务隔离级别
transaction_isolation = READ-COMMITTED

# 从库磁盘写入优化
innodb_flush_log_at_trx_commit = 0
sync_binlog = 0

# relay log配置
relay_log_recovery = ON
relay_log_purge = ON
max_relay_log_size = 1G

# ---------- 性能优化配置 ----------
innodb_read_io_threads = 80
innodb_write_io_threads = 80
innodb_buffer_pool_size = 64G
innodb_buffer_pool_instances = 16
innodb_parallel_read_threads = 16

# NVMe优化
innodb_io_capacity = 4000
innodb_io_capacity_max = 8000
innodb_flush_neighbors = 0

# ---------- 内存相关配置 ----------
key_buffer_size = 128M
max_heap_table_size = 2G
tmp_table_size = 2G
join_buffer_size = 128M
sort_buffer_size = 32M
read_buffer_size = 8M
read_rnd_buffer_size = 32M
myisam_sort_buffer_size = 16M

# ---------- 基础配置 ----------
port = 61786
socket = /tmp/mysql.sock
datadir = /www/server/data
default-time-zone = '+08:00'
lower_case_table_names = 1
thread_stack = 512K

# ---------- 字符集配置 ----------
character-set-server = utf8mb4
collation-server = utf8mb4_0900_ai_ci

# ---------- 认证和安全 ----------
skip-name-resolve = 1
default_authentication_plugin = mysql_native_password
tls_version = TLSv1.2,TLSv1.3

# ---------- GTID和复制配置 ----------
gtid-mode = ON
enforce-gtid-consistency = 1

# 跳过复制错误
replica_skip_errors = ddl_exist_errors,1062,1068,1072,1146

# 复制压缩
replica_compressed_protocol = 1
protocol_compression_algorithms = zstd,zlib,uncompressed

# ---------- Binlog配置（从库简化）----------
binlog_format = ROW
binlog_expire_logs_auto_purge = ON
binlog_row_image = FULL
binlog_row_metadata = MINIMAL
binlog_cache_size = 4M
binlog_expire_logs_seconds = 259200
max_binlog_size = 1G

# ---------- 连接数设置 ----------
max_connections = 1000
thread_cache_size = 64
wait_timeout = 28800
interactive_timeout = 28800
open_files_limit = 65535

# ---------- 存储引擎配置 ----------
default_storage_engine = InnoDB
innodb_file_per_table = 1
innodb_flush_method = O_DIRECT
innodb_autoinc_lock_mode = 2

# 缓存相关配置
performance_schema_max_table_instances = 2000
table_definition_cache = 2000
table_open_cache = 2000

# ---------- InnoDB配置 ----------
innodb_data_home_dir = /www/server/data
innodb_log_group_home_dir = /www/server/data
innodb_redo_log_capacity = 1073741824
innodb_log_buffer_size = 32M
innodb_data_file_path = ibdata1:10M:autoextend
innodb_temp_data_file_path = ibtmp1:12M:autoextend
innodb_lock_wait_timeout = 50
innodb_max_dirty_pages_pct = 75

# ---------- 查询相关 ----------
max_allowed_packet = 64M

sql-mode = "STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO"
explicit_defaults_for_timestamp = true

# ---------- 慢查询日志 ----------
slow-query-log-file = /www/server/data/mysql-slow.log
slow_query_log = ON
long_query_time = 1

[mysql]
no-auto-rehash

[myisamchk]
key_buffer_size = 1024M
sort_buffer_size = 16M
read_buffer = 2M
write_buffer = 2M

[mysqlhotcopy]
interactive-timeout
